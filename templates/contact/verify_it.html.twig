{% extends 'base.html.twig' %}

{% block body %}
    <div class="verification-page">

        <!-- Header Section -->
        <header class="verification-header">
            <div class="container">
                <p><img src="{{ asset('build/images/regiosuisse-logo.svg') }}" alt="Logo" class="logo"></p>
            </div>
            <div class="container">
                <h1>Verifica le informazioni di contatto</h1>
            </div>
            <div class="container">
                <p style="color: black">Si prega di rivedere le informazioni di contatto e aggiornarle se necessario. Se desideri essere eliminato dal nostro database, seleziona la casella sottostante e salva le tue informazioni.</p>
            </div>
            <div class="container verification-header-seperator"></div>
        </header>

        <!-- Form Section -->
        <div class="container">
            {{ form_start(form) }}
            <div class="verification-form">
                <div class="verification-form-row">
                    <div class="verification-form-group">
                        <h2>Informazioni personali</h2>
                        {{ form_row(form.academicTitle, { label: 'Titolo accademico', attr: { class: 'form-control' } }) }}
                        {{ form_row(form.firstName, { label: 'Nome', attr: { class: 'form-control' } }) }}
                        {{ form_row(form.lastName, { label: 'Cognome', attr: { class: 'form-control' } }) }}
                        {{ form_row(form.gender, { label: 'Genere', attr: { class: 'form-control' } }) }}
                    </div>

                    <div class="verification-form-group">
                        <h2>Informazioni di contatto</h2>
                        {{ form_row(form.email, { label: 'E-mail', attr: { class: 'form-control' } }) }}
                        {{ form_row(form.phone, { label: 'Telefono', attr: { class: 'form-control' } }) }}

                        <!-- Multilingual Website field with locale switch buttons -->
                        <div class="website" style="display: flex; flex-direction: row;">
                            <label id="website-label-de" style="display:none;">Sito web (DE)</label>
                            <label id="website-label-fr" style="display:none;">Sito web (FR)</label>
                            <label id="website-label-it">Sito web (IT)</label>
                            <span>
                                <a href="#" class="btn locale-btn" onclick="changeLocale('de', 'website', event)">DE</a>
                                <span>|</span>
                                <a href="#" class="btn locale-btn" onclick="changeLocale('fr', 'website', event)">FR</a>
                                <span>|</span>
                                <a href="#" class="btn locale-btn" onclick="changeLocale('it', 'website', event)">IT</a>
                            </span>
                        </div>
                        <div id="website-de" class="locale-input" style="display:none;">
                            {{ form_row(form.website, { label: false , attr: { class: 'form-control' }}) }}
                        </div>
                        <div id="website-fr" class="locale-input" style="display:none;">
                            {{ form_row(form.translations_fr_website, { label: false, attr: { class: 'form-control' } }) }}
                        </div>
                        <div id="website-it" class="locale-input">
                            {{ form_row(form.translations_it_website, { label: false, attr: { class: 'form-control' } }) }}
                        </div>
                    </div>
                </div>

                <div class="verification-form-row">
                    <div class="verification-form-group">
                        <h2>Indirizzo</h2>
                        {{ form_row(form.street, { label: 'Via', attr: { class: 'form-control' } }) }}
                        {{ form_row(form.zipCode, { label: 'Codice postale', attr: { class: 'form-control' } }) }}

                        <!-- Multilingual City field with locale switch buttons -->
                        <div class="city" style="display: flex; flex-direction: row;">
                            <label id="city-label-de" style="display:none;">Città (DE)</label>
                            <label id="city-label-fr" style="display:none;">Città (FR)</label>
                            <label id="city-label-it">Città (IT)</label>
                            <span>
                                <a href="#" class="btn locale-btn" onclick="changeLocale('de', 'city', event)">DE</a>
                                <span>|</span>
                                <a href="#" class="btn locale-btn" onclick="changeLocale('fr', 'city', event)">FR</a>
                                <span>|</span>
                                <a href="#" class="btn locale-btn" onclick="changeLocale('it', 'city', event)">IT</a>
                            </span>
                        </div>
                        <div id="city-de" class="locale-input" style="display:none;">
                            {{ form_row(form.city, { label: false, attr: { class: 'form-control' } }) }}
                        </div>
                        <div id="city-fr" class="locale-input" style="display:none;">
                            {{ form_row(form.translations_fr_city, { label: false, attr: { class: 'form-control' } }) }}
                        </div>
                        <div id="city-it" class="locale-input">
                            {{ form_row(form.translations_it_city, { label: false , attr: { class: 'form-control' }}) }}
                        </div>

                        {{ form_row(form.country, { label: 'Paese', attr: { class: 'form-control' } }) }}
                    </div>

                    <div class="verification-form-group">
                        <h2>Altre informazioni</h2>
                        {{ form_row(form.language, { label: 'Lingua', attr: { class: 'form-control' } }) }}

                        <!-- Multilingual Description field with locale switch buttons -->
                        <div class="description" style="display: flex; flex-direction: row;">
                            <label id="description-label-de" style="display:none;">Descrizione (DE)</label>
                            <label id="description-label-fr" style="display:none;">Descrizione (FR)</label>
                            <label id="description-label-it">Descrizione (IT)</label>
                            <span>
                                <a href="#" class="btn locale-btn" onclick="changeLocale('de', 'description', event)">DE</a>
                                <span>|</span>
                                <a href="#" class="btn locale-btn" onclick="changeLocale('fr', 'description', event)">FR</a>
                                <span>|</span>
                                <a href="#" class="btn locale-btn" onclick="changeLocale('it', 'description', event)">IT</a>
                            </span>
                        </div>
                        <div id="description-de" class="locale-input" style="display:none;">
                            {{ form_row(form.description, { label: false, attr: { class: 'form-control' } }) }}
                        </div>
                        <div id="description-fr" class="locale-input" style="display:none;">
                            {{ form_row(form.translations_fr_description, { label: false, attr: { class: 'form-control' } }) }}
                        </div>
                        <div id="description-it" class="locale-input">
                            {{ form_row(form.translations_it_description, { label: false, attr: { class: 'form-control' } }) }}
                        </div>
                    </div>
                </div>

                <div class="verification-form-row verification-form-group">
                    <h2 style="margin-bottom: 0">Posizioni attuali</h2>
                </div>
                <div class="verification-form-row ">
                    {% for employment in employments %}
                        <div class="verification-form-group col-md-6" id="employment-group-{{ employment.id }}">
                            <div style="display: flex; flex-direction: row; justify-content: space-between;">
                                <label style="text-decoration: underline;">{{ employment.companyName }}</label>
                                <div class="idontworkhere-checkbox-container">
                                    <input 
                                        type="checkbox" 
                                        name="removeEmploymentIds[]" 
                                        value="{{ employment.id }}" 
                                        id="employment-checkbox-{{ employment.id }}"
                                        onchange="toggleDisabledState({{ employment.id }})">
                                    <span>Non lavoro più qui.</span>
                                </div>
                            </div>

                            <!-- Locale Switch Buttons for Role -->
                            <div class="role" style="display: flex; flex-direction: row;">
                                <label id="role-label-{{ employment.id }}-de" style="display:none;">Ruolo (DE)</label>
                                <label id="role-label-{{ employment.id }}-fr" style="display:none;">Ruolo (FR)</label>
                                <label id="role-label-{{ employment.id }}-it">Ruolo (IT)</label>
                                <span>
                                    <a href="#" class="btn locale-btn" onclick="changeEmploymentLocale('{{ employment.id }}', 'de', event)">DE</a>
                                    <span>|</span>
                                    <a href="#" class="btn locale-btn" onclick="changeEmploymentLocale('{{ employment.id }}', 'fr', event)">FR</a>
                                    <span>|</span>
                                    <a href="#" class="btn locale-btn" onclick="changeEmploymentLocale('{{ employment.id }}', 'it', event)">IT</a>
                                </span>
                            </div>

                            <!-- Input Fields for Role -->
                            <div id="role-{{ employment.id }}-de" class="locale-input" style="display:none;">
                                <input type="text" name="employments[{{ employment.id }}][role]" value="{{ employment.role }}" class="form-control"></input>
                            </div>
                            <div id="role-{{ employment.id }}-fr" class="locale-input" style="display:none;">
                                <input type="text" name="employments[{{ employment.id }}][translations][fr][role]" value="{{ employment.translations['fr']['role'] ?? '' }}" class="form-control"></input>
                            </div>
                            <div id="role-{{ employment.id }}-it" class="locale-input">
                                <input type="text" name="employments[{{ employment.id }}][translations][it][role]" value="{{ employment.translations['it']['role'] ?? '' }}" class="form-control"></input>
                            </div>
                        </div>
                    {% endfor %}

                    {% if employments|length % 2 != 0 %}
                        <div class="employment-item verification-form-group col-md-6"></div>
                    {% endif %}
                </div>

                <div class="verification-form-row">
                    <div class="verification-form-group">
                        <div>
                            <h2>Esci</h2>
                            <div style="display: flex; flex-direction: row; margin-top: 40px; align-content: center;">
                                <input type="checkbox" name="delete" value="1">
                                <span style="margin-left: 5px; color: black">Voglio essere cancellato dal database.</span>
                            </div>
                        </div>
                    </div>
                    <div class="verification-form-group"></div>
                </div>

                <div class="form-actions">
                    <button class="btn btn-primary">Salva</button>
                </div>
            </div>
            {{ form_end(form) }}
        </div>

        <!-- Footer Section -->
        <footer class="verification-footer">
            <div class="container">
                <p>©
                    {{ "now"|date("Y") }}
                    regiosuisse - La piattaforma per lo sviluppo regionale in Svizzera</p>
                <p>
                    <a href="https://www.regiosuisse.ch" target="_blank">www.regiosuisse.ch</a>
                    <span>In caso di domande o problemi, si prega di contattare
                        <a href="mailto:web@regiosuisse.ch">web@regiosuisse.ch</a>
                    </span>
                </p>
            </div>
        </footer>
    </div>

    <script>
        function changeLocale(locale, field, event) {
            if (event) {
                event.preventDefault();
            }
            document.getElementById(field + '-de').style.display = 'none';
            document.getElementById(field + '-fr').style.display = 'none';
            document.getElementById(field + '-it').style.display = 'none';

            document.getElementById(field + '-label-de').style.display = 'none';
            document.getElementById(field + '-label-fr').style.display = 'none';
            document.getElementById(field + '-label-it').style.display = 'none';

            document.getElementById(field + '-' + locale).style.display = 'block';
            document.getElementById(field + '-label-' + locale).style.display = 'block';
        }

        document.addEventListener("DOMContentLoaded", function () {
            changeLocale('it', 'website');
            changeLocale('it', 'city');
            changeLocale('it', 'description');
        });

        function changeEmploymentLocale(employmentId, locale, event) {
            if (event) {
                event.preventDefault();
            }
            // Nascondi tutti i campi di input per il ruolo dell'impiego corrente
            document.getElementById('role-' + employmentId + '-de').style.display = 'none';
            document.getElementById('role-' + employmentId + '-fr').style.display = 'none';
            document.getElementById('role-' + employmentId + '-it').style.display = 'none';

            document.getElementById('role-label-' + employmentId + '-de').style.display = 'none';
            document.getElementById('role-label-' + employmentId + '-fr').style.display = 'none';
            document.getElementById('role-label-' + employmentId + '-it').style.display = 'none';

            // Mostra il campo di input della lingua selezionata
            document.getElementById('role-' + employmentId + '-' + locale).style.display = 'block';
            document.getElementById('role-label-' + employmentId + '-' + locale).style.display = 'block';
        }

        function toggleDisabledState(employmentId) {
            const employmentGroup = document.getElementById(`employment-group-${employmentId}`);
            const inputs = employmentGroup.querySelectorAll('input[type="text"], select, textarea');

            // Alterna la classe disabilitata e gli eventi del puntatore su tutti i campi tranne la casella di controllo
            inputs.forEach(input => {
                input.disabled = document.getElementById(`employment-checkbox-${employmentId}`).checked;
            });
            
            // Aggiorna lo stile di opacità
            if (document.getElementById(`employment-checkbox-${employmentId}`).checked) {
                employmentGroup.classList.add("disabled-fields");
            } else {
                employmentGroup.classList.remove("disabled-fields");
            }
        }

        // Inizializza la lingua a 'it' per ogni impiego
        document.addEventListener("DOMContentLoaded", function () {
            {% for employment in employments %}
                changeEmploymentLocale('{{ employment.id }}', 'it');
            {% endfor %}
        });
    </script>
{% endblock %}