<!DOCTYPE html>
<html>

    <head>

        <style>
            body {
                font-family: "Noto Sans", Noto Sans, Arial, sans-serif;
                font-size: 10px;
                font-weight: normal;
                color: #141C22;
            }

            h1 {
                font-size: 32px;
                color: #FF0000;
            }

            h2 {
                font-size: 16px;
                margin-top: 40px;
            }

            h3 {
                font-size: 12px;
            }

            h1,
            h2,
            h3 {
                font-weight: bold;
            }

            p {
                margin-bottom: 10px;
            }

            a {
                color: #006699;
                text-decoration: none;
            }

            ul {
                padding: 0;
                margin-left: 16px;
                list-style: square;
            }

            li,
            .list-item {
                margin-bottom: 0;
            }
        </style>

    </head>

    <body>
        {# For debugging purposes #}
        {# <div style="display:none">Current locale: {{ app.request.locale }}</div> #}

        <h1>{{ pv_trans(financialSupport, 'name', app.request.locale) }}</h1>

        <div style="width: 100%;">
            {% set description = pv_trans(financialSupport, 'description', app.request.locale) %}
            {% if description|trim is not empty %}
            <div style="float: left; width: 60%;">
                {{ description|raw }}
            </div>
            {% endif %}
            <div style="float: right; width: 30%;">
                {% if logo %}
                    <img style="width: 100%;margin-top:5px" src="{{ logo }}" alt="Logo">
                {% endif %}
            </div>
        </div>

        <div style="width: 100%;">
            <div style="float: left; width: 60%;">

                {% set additionalInfo = pv_trans(financialSupport, 'additionalInformation', app.request.locale) %}
                {% if additionalInfo|trim is not empty %}
                    {# Use translations variable or fall back to trans filter #}
                    <h2>{{ translations['Kurzbeschrieb'] is defined ? translations['Kurzbeschrieb'] : ('Kurzbeschrieb' | trans) }}</h2>
                    {{ additionalInfo|raw }}
                {% endif %}

                {% set inclusionCriteria = pv_trans(financialSupport, 'inclusionCriteria', app.request.locale) %}
                {% if inclusionCriteria|trim is not empty %}
                    <h2>{{ translations['Teilnahmekriterien'] is defined ? translations['Teilnahmekriterien'] : ('Teilnahmekriterien' | trans) }}</h2>
                    {{ inclusionCriteria|raw }}
                {% endif %}

                {% set exclusionCriteria = pv_trans(financialSupport, 'exclusionCriteria', app.request.locale) %}
                {% if exclusionCriteria|trim is not empty %}
                    <h2>{{ translations['Ausschlusskriterien'] is defined ? translations['Ausschlusskriterien'] : ('Ausschlusskriterien' | trans) }}</h2>
                    {{ exclusionCriteria|raw }}
                {% endif %}

                {% set application = pv_trans(financialSupport, 'application', app.request.locale) %}
                {% if application|trim is not empty %}
                    <h2>{{ translations['Beantragung'] is defined ? translations['Beantragung'] : ('Beantragung' |trans) }}</h2>
                    {{ application|raw }}
                {% endif %}

                {% set applicationTips = pv_trans(financialSupport, 'applicationTips', app.request.locale) %}
                {% if applicationTips|trim is not empty %}
                    <h2>{{ translations['Tipps zur Beantragung'] is defined ? translations['Tipps zur Beantragung'] : ('Tipps zur Beantragung' |trans) }}</h2>
                    {{ applicationTips|raw }}
                {% endif %}

                {% set financingRatio = pv_trans(financialSupport, 'financingRatio', app.request.locale) %}
                {% if financingRatio|trim is not empty %}
                    <h2>{{ translations['Finanzierung'] is defined ? translations['Finanzierung'] : ('Finanzierung' | trans) }}</h2>
                    {{ financingRatio|raw }}
                {% endif %}

                {% set contacts = pv_trans(financialSupport, 'contacts', app.request.locale)|default([]) %}
                {% if contacts is not empty %}
                    <h2>{{ translations['Kontakt'] is defined ? translations['Kontakt'] : ('Kontakt' |trans) }}</h2>
                    
                    {# Single column layout with subtle separator lines #}
                    {% for contact in contacts %}
                        <div style="padding: 12px 0; {% if not loop.last %}border-bottom: 1px solid #e0e0e0; margin-bottom: 12px;{% endif %}">
                            {% if contact.name|default %}
                                <p style="margin: 0 0 8px 0; font-size: 14px;"><strong>{{ contact.name }}</strong></p>
                            {% endif %}

                            {% if contact.department|default %}
                                <p style="margin: 0 0 5px 0;">{{ contact.department }}</p>
                            {% endif %}
                            
                            {% set personInfo = [] %}
                            {% if contact.type|default == 'person' %}
                                {% if contact.salutation|default %}
                                    {% set personInfo = personInfo|merge([contact.salutation == 'm' ? 'Herr' : 'Frau']) %}
                                {% endif %}
                                {% if contact.title|default %}
                                    {% set personInfo = personInfo|merge([contact.title]) %}
                                {% endif %}
                                {% if contact.firstName|default %}
                                    {% set personInfo = personInfo|merge([contact.firstName]) %}
                                {% endif %}
                                {% if contact.lastName|default %}
                                    {% set personInfo = personInfo|merge([contact.lastName]) %}
                                {% endif %}
                                {% if personInfo is not empty %}
                                    <p style="margin: 0 0 5px 0;"><strong>{{ personInfo|join(' ') }}</strong></p>
                                {% endif %}
                            {% endif %}
                            
                            {% if contact.role|default %}
                                <p style="margin: 0 0 5px 0; font-style: italic;">{{ contact.role }}</p>
                            {% endif %}
                            
                            {% if contact.street|default %}
                                <p style="margin: 0 0 3px 0;">{{ contact.street }}</p>
                            {% endif %}
                            
                            {% if contact.zipCode|default or contact.city|default %}
                                <p style="margin: 0 0 5px 0;">{{ contact.zipCode|default }} {{ contact.city|default }}</p>
                            {% endif %}
                            
                            {% if contact.addressSupplement|default %}
                                <p style="margin: 0 0 5px 0; font-size: 12px; color: #666;">{{ contact.addressSupplement }}</p>
                            {% endif %}
                            
                            {% if contact.email|default or contact.phone|default or contact.website|default %}
                                <p style="margin: 5px 0 0 0;">
                                    {% if contact.email|default %}
                                        <a href="mailto:{{ contact.email }}">{{ contact.email }}</a><br>
                                    {% endif %}
                                    {% if contact.phone|default %}
                                        {{ contact.phone }}<br>
                                    {% endif %}
                                    {% if contact.website|default %}
                                        <a href="{{ contact.website }}" target="_blank">{{ contact.website }}</a><br>
                                    {% endif %}
                                </p>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% endif %}

                {% set links = pv_trans(financialSupport, 'links', app.request.locale)|default([]) %}
                {% if links is not empty %}
                    <h2>{{ translations['Mehr Informationen'] is defined ? translations['Mehr Informationen'] : ('Mehr Informationen' |trans) }}</h2>
                    <div class="list">
                        {% for link in links %}
                            <div class="list-item">
                                {{ link.label }}<br>
                                <a href="{{ link.value }}" target="_blank">{{ link.value }}</a>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}

                {% set appointments = pv_trans(financialSupport, 'appointments', app.request.locale)|default([]) %}
                {% if appointments is not empty %}
                    <h2>{{ translations['Termine'] is defined ? translations['Termine'] : ('Termine' |trans) }}</h2>
                    <div class="list">
                        {% for appointment in appointments %}
                            <div class="list-item">
                                {{ appointment.date|date('d.m.Y') }}
                                {% if appointment.description|default %} 
                                    - {{ appointment.description|raw }}
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div style="float: right; width: 30%;">
                {% if financialSupport.startDate or financialSupport.endDate %}
                    <h2>{{ translations['Laufzeit'] is defined ? translations['Laufzeit'] : ('Laufzeit' |trans) }}</h2>
                    <div class="list">
                        {% if financialSupport.startDate %}
                            <div class="list-item">
                                {{ translations['Start'] is defined ? translations['Start'] : ('Start' |trans) }}: {{ financialSupport.startDate|date('d.m.Y') }}
                            </div>
                        {% endif %}
                        {% if financialSupport.endDate %}
                            <div class="list-item">
                                {{ translations['Ende'] is defined ? translations['Ende'] : ('Ende' |trans) }}: {{ financialSupport.endDate|date('d.m.Y') }}
                            </div>
                        {% endif %}
                    </div>
                {% endif %}

                {% if financialSupport.fundingProvider %}
                    <h2>{{ translations['Förderstelle'] is defined ? translations['Förderstelle'] : ('Förderstelle'|trans) }}</h2>
                    <div class="list">
                        <div class="list-item">{{ pv_trans(financialSupport, 'fundingProvider', app.request.locale) }}</div>
                    </div>
                {% endif %}

                {% if financialSupport.instruments|length > 0 %}
                    <h2>{{ translations['Unterstützungsform'] is defined ? translations['Unterstützungsform'] : ('Unterstützungsform'|trans) }}</h2>
                    <ul class="list">
                        {% set instruments = [] %}
                        {% set other_instrument_value = null %}
                        {% for instrument in financialSupport.instruments %}
                            {% if instrument.name == 'Weitere' and financialSupport.otherOptionValues.instrument is defined and financialSupport.otherOptionValues.instrument is not empty %}
                                {% set weitereText = app.request.locale == 'de' ? 'Weitere' : (app.request.locale == 'fr' ? 'Autres' : 'Altri') %}
                                {% set otherValue = app.request.locale == 'de' ? financialSupport.otherOptionValues.instrument : 
                                                     (financialSupport.translations[app.request.locale] is defined and 
                                                      financialSupport.translations[app.request.locale].otherOptionValues is defined ? 
                                                      financialSupport.translations[app.request.locale].otherOptionValues.instrument : 
                                                      financialSupport.otherOptionValues.instrument) %}
                                {% set other_instrument_value = weitereText ~ ': ' ~ otherValue %}
                            {% else %}
                                {% set instruments = instruments|merge([pv_trans(instrument, 'name', app.request.locale)]) %}
                            {% endif %}
                        {% endfor %}
                        {% if other_instrument_value is not null %}
                            {% set instruments = instruments|merge([other_instrument_value]) %}
                        {% endif %}
                        {% set sortedInstruments = instruments|sort((a, b) => (
                            a.position is null and b.position is null ? 0 :
                            a.position is null ? 1 :
                            b.position is null ? -1 :
                            a.position <=> b.position
                        )) %}
                        {% for instrument in sortedInstruments %}
                            <li class="list-item">{{ instrument }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}

                {% if financialSupport.beneficiaries|length > 0 %}
                    <h2>{{ translations['Begünstigte'] is defined ? translations['Begünstigte'] : ('Begünstigte'|trans) }}</h2>
                    <ul class="list">
                        {% set beneficiaries = [] %}
                        {% set other_beneficiary_value = null %}
                        {% for beneficiary in financialSupport.beneficiaries %}
                            {% if beneficiary.name == 'Weitere' and financialSupport.otherOptionValues.beneficiary is defined and financialSupport.otherOptionValues.beneficiary is not empty %}
                                {% set weitereText = app.request.locale == 'de' ? 'Weitere' : (app.request.locale == 'fr' ? 'Autres' : 'Altri') %}
                                {% set otherValue = app.request.locale == 'de' ? financialSupport.otherOptionValues.beneficiary : 
                                                     (financialSupport.translations[app.request.locale] is defined and 
                                                      financialSupport.translations[app.request.locale].otherOptionValues is defined ? 
                                                      financialSupport.translations[app.request.locale].otherOptionValues.beneficiary : 
                                                      financialSupport.otherOptionValues.beneficiary) %}
                                {% set other_beneficiary_value = weitereText ~ ': ' ~ otherValue %}
                            {% else %}
                                {% set beneficiaries = beneficiaries|merge([pv_trans(beneficiary, 'name', app.request.locale)]) %}
                            {% endif %}
                        {% endfor %}
                        {% if other_beneficiary_value is not null %}
                            {% set beneficiaries = beneficiaries|merge([other_beneficiary_value]) %}
                        {% endif %}
                        {% set sortedBeneficiaries = beneficiaries|sort((a, b) => (
                            a.position is null and b.position is null ? 0 :
                            a.position is null ? 1 :
                            b.position is null ? -1 :
                            a.position <=> b.position
                        )) %}
                        {% for beneficiary in sortedBeneficiaries %}
                            <li class="list-item">{{ beneficiary }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}

                {% if financialSupport.topics is not empty %}
                    <h2>{{ translations['Themenschwerpunkt'] is defined ? translations['Themenschwerpunkt'] : ('Themenschwerpunkt' |trans) }}</h2>
                    <ul class="list">
                        {% set sortedTopics = financialSupport.topics|sort((a, b) => (
                            a.position is null and b.position is null ? 0 :
                            a.position is null ? 1 :
                            b.position is null ? -1 :
                            a.position <=> b.position
                        )) %}
                        {% for topic in sortedTopics %}
                            <li class="list-item">{{ pv_trans(topic, 'name', app.request.locale) }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}

                {% if financialSupport.projectTypes is not empty %}
                    <h2>{{ translations['Innovationsphasen'] is defined ? translations['Innovationsphasen'] : ('Innovationsphasen' |trans) }}</h2>
                    <ul class="list">
                        {% set sortedProjectTypes = financialSupport.projectTypes|sort((a, b) => (
                            a.position is null and b.position is null ? 0 :
                            a.position is null ? 1 :
                            b.position is null ? -1 :
                            a.position <=> b.position
                        )) %}
                        {% for projectType in sortedProjectTypes %}
                            <li class="list-item">{{ pv_trans(projectType, 'name', app.request.locale) }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}

                {% if financialSupport.geographicRegions is not empty %}
                    <h2>{{ translations['Fördergebiet'] is defined ? translations['Fördergebiet'] : ('Fördergebiet' |trans) }}</h2>
                    <ul class="list">
                        {% set sortedGeographicRegions = financialSupport.geographicRegions|sort((a, b) => (
                            a.position is null and b.position is null ? 0 :
                            a.position is null ? 1 :
                            b.position is null ? -1 :
                            a.position <=> b.position
                        )) %}
                        {% for geographicRegion in sortedGeographicRegions %}
                            <li class="list-item">{{ pv_trans(geographicRegion, 'name', app.request.locale) }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        </div>
    </body>
</html>